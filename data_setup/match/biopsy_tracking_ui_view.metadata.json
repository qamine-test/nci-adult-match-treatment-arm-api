{"options":{"viewOn":"patient","pipeline":[{"$unwind":"$biopsies"},{"$replaceRoot":{"newRoot":"$biopsies"}},{"$project":{"mdAndersonMessages.biopsySequenceNumber":1.0,"mdAndersonMessages.patientSequenceNumber":1.0,"mdAndersonMessages.molecularSequenceNumber":1.0,"mdAndersonMessages.destinationSite":1.0,"mdAndersonMessages.trackingNumber":1.0,"mdAndersonMessages.reportedDate":1.0,"mdAndersonMessages.message":1.0,"_id":0.0}},{"$project":{"hasMsn":{"$filter":{"input":"$mdAndersonMessages","as":"msg","cond":{"$ifNull":["$$msg.molecularSequenceNumber",false]}}},"specimenReceived":{"$reverseArray":{"$filter":{"input":"$mdAndersonMessages","as":"msg","cond":{"$eq":["$$msg.message","SPECIMEN_RECEIVED"]}}}},"specimenFailure":{"$reverseArray":{"$filter":{"input":"$mdAndersonMessages","as":"msg","cond":{"$eq":["$$msg.message","SPECIMEN_FAILURE"]}}}},"pathologyConfirmation":{"$reverseArray":{"$filter":{"input":"$mdAndersonMessages","as":"msg","cond":{"$eq":["$$msg.message","PATHOLOGY_CONFIRMATION"]}}}}}},{"$unwind":"$hasMsn"},{"$project":{"molecularSequenceNumber":"$hasMsn.molecularSequenceNumber","biopsySequenceNumber":"$hasMsn.biopsySequenceNumber","patientSequenceNumber":"$hasMsn.patientSequenceNumber","location":"$hasMsn.destinationSite","trackingNumber":"$hasMsn.trackingNumber","nucleicAcidSendoutDate":"$hasMsn.reportedDate","specimenReceivedDate":{"$arrayElemAt":["$specimenReceived.reportedDate",0.0]},"specimenFailureDate":{"$arrayElemAt":["$specimenFailure.reportedDate",0.0]},"pathologyConfirmationDate":{"$arrayElemAt":["$pathologyConfirmation.reportedDate",0.0]}}}]},"indexes":[]}